<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Control</title>
  <style>
    body { font-family: Arial; background:#f2f2f2; padding:20px;}
    h2 { text-align:center; margin-bottom:20px; }
    table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
    th, td { border:1px solid #ccc; padding:10px; text-align:center; }
    th { background:#333; color:#fff; }
    tr:nth-child(even) { background:#f9f9f9; }
    .reciente { background-color:#b2f2bb !important; }
    .segundo { background-color:#d3f9d8 !important; }
  </style>
</head>
<body>
  <h2>Registro de Entradas y Salidas</h2>
  <table>
    <thead>
      <tr>
        <th>Propietario</th>
        <th>Lote</th>
        <th>Tipo</th>
        <th>Hora</th>
      </tr>
    </thead>
    <tbody id="eventos"></tbody>
  </table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyACIRPKYGEq-Zzqm3c_QXD4DzlXlZHa8Ck",
    authDomain: "propietarios-catalinas-c-8b026.firebaseapp.com",
    databaseURL: "https://propietarios-catalinas-c-8b026-default-rtdb.firebaseio.com",
    projectId: "propietarios-catalinas-c-8b026",
    storageBucket: "propietarios-catalinas-c-8b026.firebasestorage.app",
    messagingSenderId: "10002796108",
    appId: "1:10002796108:web:8ce15b43b0662ef887eee9"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const eventosTbody = document.getElementById("eventos");

  onValue(ref(db, "eventos"), (snapshot) => {
    eventosTbody.innerHTML = "";
    if (snapshot.exists()) {
      const eventos = [];
      snapshot.forEach(child => {
        eventos.push(child.val());
      });

      // Ordenar por fecha/hora descendente (mÃ¡s reciente primero)
      eventos.sort((a, b) => {
        return new Date(b.hora.replace(/(\d{2}):(\d{2}) \((\d{2})\/(\d{2})\/(\d{4})\)/, "$4-$3-$5T$1:$2")) -
               new Date(a.hora.replace(/(\d{2}):(\d{2}) \((\d{2})\/(\d{2})\/(\d{4})\)/, "$4-$3-$5T$1:$2"));
      });

      eventos.forEach((evento, index) => {
        const tr = document.createElement("tr");
        if (index === 0) tr.classList.add("reciente");
        if (index === 1) tr.classList.add("segundo");
        tr.innerHTML = `
          <td>${evento.propietario}</td>
          <td>${evento.lote}</td>
          <td>${evento.tipo}</td>
          <td>${evento.hora}</td>
        `;
        eventosTbody.appendChild(tr);
      });
    }
  });
</script>
</body>
</html>
