<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel de Ingresos y Egresos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background:#f8f9fa;
      margin:0;
      padding:20px;
    }
    h1 {
      text-align:center;
      margin-bottom:20px;
      color:#333;
    }
    table {
      width:100%;
      border-collapse:collapse;
      background:#fff;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      padding:10px;
      border-bottom:1px solid #ddd;
      text-align:left;
    }
    th {
      background:#ff9900;
      color:#fff;
      position:sticky;
      top:0;
    }
    tr:nth-child(even) {
      background:#f9f9f9;
    }
    .recent { background:#a8f0a5 !important; }   /* más intenso */
    .second { background:#c9f7c7 !important; }   /* un poco más suave */
    @media (max-width:768px){
      table { font-size:14px; }
      th, td { padding:8px; }
    }
  </style>
</head>
<body>
  <h1>Panel de Ingresos y Egresos</h1>

  <table>
    <thead>
      <tr>
        <th>Propietario(a)</th>
        <th>Número de Lote</th>
        <th>Evento</th>
        <th>Hora (Fecha)</th>
      </tr>
    </thead>
    <tbody id="eventosBody">
      <tr><td colspan="4">Cargando eventos...</td></tr>
    </tbody>
  </table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // Configuración Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyACIRPKYGEq-Zzqm3c_QXD4DzlXlZHa8Ck",
    authDomain: "propietarios-catalinas-c-8b026.firebaseapp.com",
    databaseURL: "https://propietarios-catalinas-c-8b026-default-rtdb.firebaseio.com",
    projectId: "propietarios-catalinas-c-8b026",
    storageBucket: "propietarios-catalinas-c-8b026.firebasestorage.app",
    messagingSenderId: "10002796108",
    appId: "1:10002796108:web:8ce15b43b0662ef887eee9"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const eventosBody = document.getElementById("eventosBody");

  function formatDateTime(timestamp) {
    const date = new Date(timestamp);
    const h = String(date.getHours()).padStart(2,"0");
    const m = String(date.getMinutes()).padStart(2,"0");
    const d = String(date.getDate()).padStart(2,"0");
    const mo = String(date.getMonth()+1).padStart(2,"0");
    const y = date.getFullYear();
    return `${h}:${m} (${d}/${mo}/${y})`;
  }

  // Escuchar eventos
  const eventosRef = ref(db, "eventos");
  onValue(eventosRef, (snapshot) => {
    eventosBody.innerHTML = "";
    if (!snapshot.exists()) {
      eventosBody.innerHTML = `<tr><td colspan="4">No hay eventos registrados.</td></tr>`;
      return;
    }

    const eventos = [];
    snapshot.forEach(child => {
      eventos.push(child.val());
    });

    // Orden descendente (más nuevo arriba)
    eventos.sort((a,b) => b.timestamp - a.timestamp);

    eventos.forEach((ev, idx) => {
      const tr = document.createElement("tr");

      if (idx === 0) tr.classList.add("recent");
      if (idx === 1) tr.classList.add("second");

      tr.innerHTML = `
        <td>${ev.propietario ?? ""}</td>
        <td>${ev.lote ?? ""}</td>
        <td>${ev.tipo ?? ""}</td>
        <td>${ev.timestamp ? formatDateTime(ev.timestamp) : ""}</td>
      `;

      eventosBody.appendChild(tr);
    });
  });
</script>
</body>
</html>
